<html>
	<style>
		body {
			background-color: #333;
			font-family: Arial;
			font-size: 20px;
			margin: 0 auto;
			max-width: 800px;
			padding: 10px 10px;
		}
		.wrapper {
			border-radius: 30px;
			overflow: hidden;
		}
		textarea {
			background-color: #555;
			border: none;
			color: #fff;
			font-family: Arial;
			height: 33%;
			outline: 0;
			padding: 30px 50px;
			resize: none;
			width: 100%;
		}
		#infix {
			background-color: #666;
		}
		.helpWrapper {
			border-top-right-radius: 30px;
			height: calc(33% - 7px);
			margin: 0 auto;
			max-width: 800px;
			overflow: hidden;
			padding: 0;
			pointer-events: none;
			position: absolute;
			width: 100%;
		}
		#help {
			background-color: #5d5d5d;
			color: #fff;
			float: right;
			height: 100%;
			padding: 30px 30px;
			pointer-events: default;
			width: 300px;
		}
		.rotated {
			color: #777;
			margin-left: -25px;
			margin-top: 150px;
			position: fixed;
			transform-origin: top left;
			transform: rotate(-90deg);
		}
	</style>
	<div class='wrapper'>
		<div class='helpWrapper'>
			<textarea id='help' readonly>Supported operators:

( ) [ ] - + ~ !
* / % - + <<
>> <<< >>>
< > <= >= &
| == != ^ &&
^^ ||

Supported functions:

sq(x): Square a number
abs(x): Absolute value of a number
min(x, y): Minimum of two values
max(x, y): Maximum of two values</textarea>
		</div>
		<p class='rotated'>INFIX</p>
		<textarea id='infix' oninput='update()'>42
42 * 42
42 / 42
42 % 42
42 - 42
42 + 42
42 << 1
42 >> 1
42 <<< 1
42 >>> 1
42 < 42
42 <= 42
42 > 42
42 >= 42
42 == 42
42 != 42
42 & 42
42 ^ 42
42 | 42
42 && 42
42 ^^ 42
42 || 42
-42
+42
~42
!42
42 * 0
42 * 1
255 * 255
256 * 256
257 * 257
42 / 42
84 / 2
42 / 1
1 / 42
0 / 42
41 / 42
42 / 41
42 % 42
84 % 2
42 % 1
1 % 42
0 % 42
41 % 42
42 % 41
42 - 42
42 - 0
0 - 42
32767 + 1
32767 + 2
0 << 1
1 << 0
1 << 1
1 << 2
1 << 3
1 << 4
1 << 5
1 << 6
1 << 7
1 << 8
1 << 10
1 << 11
1 << 12
1 << 13
1 << 14
1 << 15
1 << 16
1 << 17
1 << 18
1 << 20
0 >> 1
16384 >> 0
16384 >> 1
16384 >> 2
16384 >> 3
16384 >> 4
16384 >> 5
16384 >> 6
16384 >> 7
16384 >> 8
16384 >> 10
16384 >> 11
16384 >> 12
16384 >> 13
16384 >> 14
16384 >> 15
16384 >> 16
16384 >> 17
16384 >> 18
16384 >> 20
0 <<< 1
1 <<< 0
1 <<< 1
1 <<< 2
1 <<< 3
1 <<< 4
1 <<< 5
1 <<< 6
1 <<< 7
1 <<< 8
1 <<< 10
1 <<< 11
1 <<< 12
1 <<< 13
1 <<< 14
1 <<< 15
1 <<< 16
1 <<< 17
1 <<< 18
1 <<< 20
0 >>> 1
16384 >>> 0
16384 >>> 1
16384 >>> 2
16384 >>> 3
16384 >>> 4
16384 >>> 5
16384 >>> 6
16384 >>> 7
16384 >>> 8
16384 >>> 10
16384 >>> 11
16384 >>> 12
16384 >>> 13
16384 >>> 14
16384 >>> 15
16384 >>> 16
16384 >>> 17
16384 >>> 18
16384 >>> 20
42 < 41
42 < 42
42 < 43
42 <= 41
42 <= 42
42 <= 43
42 > 41
42 > 42
42 > 43
42 >= 41
42 >= 42
42 >= 43
0 == 0
0 == 1
0 != 0
0 != 1
10922 & 21845
10922 ^ 21845
10922 | 21845
10922 && 21845
10922 ^^ 21845
10922 || 21845
0 || 0
1 || 1
42 / 6 / 3
42 % 35 % 5
42 - 30 - 2
42 << 1 << 2
44 >> 1 > 1
42 <<< 2 <<< 2
42 >>> 2 >>> 2
42 < 42 < 42
42 <= 42 <= 42
42 > 42 > 42
42 >= 42 >= 42
42 == 0 == 0
42 != 42 == 0
--42
++42
~~42
!!42
42 / 42 * 7
42 % 30 / 3
42 / 30 % 3 
42 - 21 + 20
64 << 4 >> 1
64 >> 4 << 1
64 <<< 4 >>> 4
64 >>> 4 <<< 4
42 < 42 >= 0
42 == 42 != 0 
+-42
~-42
!-42
-+42
~+42
!+42
+~42
-~42
!~42
+!42
-!42
~!42
42 - 7 * 5
42 << 2 + 1
42 <= 3 >>> 2
0 == 42 < 43
42 & 0 != 0
43 ^ 42 & 42
42 | 42 ^ 42
42 && 0 | 42
43 ^^ 0 && 0
42 || 42 ^^ 42
(42 / 6) / 3
(42 % 35) % 5
(42 - 30) - 2
(42 << 1) << 2
(44 >> 1) > 1
(42 <<< 2) <<< 2
(42 >>> 2) >>> 2
(42 < 42) < 42
(42 <= 42) <= 42
(42 > 42) > 42
(42 >= 42) >= 42
(42 == 0) == 0
(42 != 42) == 0
42 / (6 / 3)
42 % (35 % 5)
42 - (30 - 2)
42 << (1 << 2)
44 >> (1 > 1)
42 <<< (2 <<< 2)
42 >>> (2 >>> 2)
42 < (42 < 42)
42 <= (42 <= 42)
42 > (42 > 42)
42 >= (42 >= 42)
42 == (0 == 0)
42 != (42 == 0)
(42 - 7) * 5
(42 << 2) + 1
(42 <= 3) >>> 2
(0 == 42) < 43
(42 & 0) != 0
(43 ^ 42) & 42
(42 | 42) ^ 42
(42 && 0) | 42
(43 ^^ 0) && 0
(42 || 42) ^^ 42
42 - (7 * 5)
42 << (2 + 1)
42 <= (3 >>> 2)
0 == (42 < 43)
42 & (0 != 0)
43 ^ (42 & 42)
42 | (42 ^ 42)
42 && (0 | 42)
43 ^^ (0 && 0)
42 || (42 ^^ 42)
~0 - 21845
-1 << 1
170 + 32 * ((((((1 << 1) << 2) + (1 << 1)) << 4) + 10)  
sq(0)
sq(16)
sq(-16)
abs(0)
abs(32000)
abs(-32000)
min(4, 10)
min(10, 4)
min(1000, 1000)
min(-1000, 1000)
min(1000, -1000)
max(4, 10)
max(10, 4)
max(1000, 1000)
max(-1000, 1000)
max(1000, -1000)
2 * sq(123 - 234) << 36 % 17
1 + 2 - 3 / 4 % 5 & max(min(sq(10),sq(100)) - abs(sq(10) - sq(max(abs(-49), 30))), 17)
</textarea>
		<p class='rotated'>POSTFIX</p>
		<textarea id='postfix' readonly></textarea>
		<p class='rotated'>EVALUATED</p>
		<textarea id='evaluated' readonly></textarea>
	</div>
	<script>
		function update() { //11 88 5 123 * / + 10 5 * +
			let infix = document.getElementById('infix').value;
			let postfix = toPostFix(infix);
			let evaluated = evaluate(postfix);

			document.getElementById('postfix').value = postfix.join('\n');
			document.getElementById('evaluated').value = evaluated;
		}

		function toPostFix(infix) {
			let lines = infix.split('\n')
			let output = [], tokens = [];
			for(line of lines) {
				line = line.replace(/(^|[^0-9A-z\)\]\s]\s*)\-(?!u)/g, '$1-u');
				line = line.replace(/(^|[^0-9A-z\)\]\s]\s*)\+(?!u)/g, '$1+u');
				line = line.replace(/(^|[^0-9A-z\)\]\s]\s*)\-(?!u)/g, '$1-u');
				line = line.replace(/(^|[^0-9A-z\)\]\s]\s*)\+(?!u)/g, '$1+u');
				tokens = line.match(/[0-9]+|\-u|\+u|sq|abs|min|max|,|<<<|>>>|==|!=|&&|\^\^|\|\||<<|>>|\<=|\>=|\<|\>|\(|\)|\[|\]|\-|\+|\~|\!|\*|\/|\%|\&|\||\^/g) || [];
				if(tokens.join('').length != line.replace(/\s/g, '').length) {
					tokens = ['ERROR: unknown token was found.'];
				}
				tokens = shuntingYard(tokens);
				output.push(tokens.join(','));
			}
			return output;
		}

		function shuntingYard(tokens) { // 2,123,234, â€“,sq,*,36,17,%,<< 
			if(tokens.length == 1 && tokens[0].startsWith('ERROR')) return tokens;
			let operators = { // [PRECEDENCE, IS_LEFT_ASSOCIATIVE]
				//'(': [14, true], ')': [14, true], '[': [14, true], ']': [14, true],
				'sq': [14, true], 'abs': [14, true], 'min': [14, true], 'max': [14, true],
				'-u': [13, false], '+u': [13, false], '~': [13, false], '!': [13, false],
				'*': [12, true], '/': [12, true], '%': [12, true],
				'-': [11, true], '+': [11, true],
				'<<': [10, false], '>>': [10, true], '<<<': [10, true], '>>>': [10, true],
				'<': [9, true], '>': [9, true], '<=': [9, true], '>=': [9, true],
				'==': [8, true], '!=': [8, true],
				'&': [7, true],
				'^': [6, true],
				'|': [5, true],
				'&&': [4, true],
				'^^': [2, false],
				'||': [1, true],
			}
			let output = [];
			let stack = [];
			for(token of tokens) {
				if(token.match(/[0-9]+/) !== null) { // Number
					output.push(token);
				} else if(token.match(/[A-z]+/) !== null && !'[]'.includes(token)) { // Function
					stack.push(token);
				} else if(operators[token] !== undefined) { // Operator
					let top = stack[stack.length - 1];
					while(operators[top] !== undefined && (
						(operators[top][1] == true && operators[token][0] <= operators[top][0]) ||
						(operators[token][1] == false && operators[token][0] < operators[top][0]))) {
						output.push(stack.pop());
						top = stack[stack.length - 1];
					}
					stack.push(token);
				} else if(token == '(') {
					stack.push(token);
				} else if(token == '[') {
					stack.push(token);
				} else if(token == ')') {
					while(stack.length > 0 && stack[stack.length - 1] != '(') {
						output.push(stack.pop());
					}
					if(stack.length == 0) {
						output = [];
						stack = ['ERROR: missing opening parentheses.'];
						break;
					}
					stack.pop(); // Pop (
				} else if(token == ']') {
					while(stack.length > 0 && stack[stack.length - 1] != '[') {
						output.push(stack.pop());
					}
					if(stack.length == 0) {
						output = [];
						stack = ['ERROR: missing square bracket.'];
						break;
					}
					stack.pop(); // Pop [
				}
			}
			/*for(i in stack) { // Convert from unary back to the original + and -
				if(stack[i] == '+u') stack[i] = '+';
				if(stack[i] == '-u') stack[i] = '-';
			}*/
			while(stack.length > 0) {
				output.push(stack.pop());
			}
			return output;
		}

		function evaluate(lines) {
			let output = [];
			for(line of lines) {
				tokens = line.split(',');
				if(tokens.length == 1 && tokens[0].startsWith('ERROR')) {
					output.push(tokens);
					continue
				}
				let stack = [];
				for(token of tokens) {
					let num, n1, n2;
					console.log('token ' + token)
					if(token == '') {
					} else if(token.match(/\d+/) !== null) { // Number
						num = parseInt(token);
						while(num > 32767) num -= 65536;
						while(num < -32768) num += 65536;
						stack.push(num);

					/*} else if(token == '+u' && stack.length >= 1 && typeof stack[stack.length - 1] == 'number') {
						stack.push(stack.pop());

					} else if(token == '-u' && stack.length >= 1 && typeof stack[stack.length - 1] == 'number') {
						num = -stack.pop()
						while(num > 32767) num -= 65536;
						while(num < -32768) num += 65536;
						stack.push(num);*/

					} else if(token == '~' && stack.length >= 1 && typeof stack[stack.length - 1] == 'number') {
						num = ~stack.pop();
						while(num > 32767) num -= 65536;
						while(num < -32768) num += 65536;
						stack.push(num);

					} else if(token == '!' && stack.length >= 1 && typeof stack[stack.length - 1] == 'number') {
						num = !stack.pop()
						stack.push(num ? -1 : 0);

					} else if(token == '*' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						n1 = stack.pop();
						n2 = stack.pop();
						num = n2 * n1;
						while(num > 32767) num -= 65536;
						while(num < -32768) num += 65536;
						stack.push(num);

					} else if(token == '/' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						n1 = stack.pop();
						n2 = stack.pop();
						num = Math.floor(n2 / n1);
						while(num > 32767) num -= 65536;
						while(num < -32768) num += 65536;
						stack.push(num);

					} else if(token == '%' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						n1 = stack.pop();
						n2 = stack.pop();
						num = n2 % n1;
						while(num > 32767) num -= 65536;
						while(num < -32768) num += 65536;
						stack.push(num);

					} else if(token == '-' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						n1 = stack.pop();
						n2 = stack.pop();
						num = n2 - n1;
						while(num > 32767) num -= 65536;
						while(num < -32768) num += 65536;
						stack.push(num);

					} else if(token == '+' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						num = stack.pop() + stack.pop();
						while(num > 32767) num -= 65536;
						while(num < -32768) num += 65536;
						stack.push(num);

					// Unary operators
					} else if(token == '+' && stack.length >= 1 && typeof stack[stack.length - 1] == 'number') {
						stack.push(stack.pop());

					} else if(token == '-' && stack.length >= 1 && typeof stack[stack.length - 1] == 'number') {
						num = -stack.pop()
						while(num > 32767) num -= 65536;
						while(num < -32768) num += 65536;
						stack.push(num);

					} else if(token == '+u' && stack.length >= 1 && typeof stack[stack.length - 1] == 'number') {
						stack.push(stack.pop());

					} else if(token == '-u' && stack.length >= 1 && typeof stack[stack.length - 1] == 'number') {
						num = -stack.pop()
						while(num > 32767) num -= 65536;
						while(num < -32768) num += 65536;
						stack.push(num);

					} else if(token == '<<' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						n1 = stack.pop();
						n2 = stack.pop();
						num = n2 << n1;
						while(num > 32767) num -= 65536;
						while(num < -32768) num += 65536;
						stack.push(num);

					} else if(token == '>>' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						n1 = stack.pop();
						n2 = stack.pop();
						num = n2 >> n1;
						while(num > 32767) num -= 65536;
						while(num < -32768) num += 65536;
						stack.push(num);

					} else if(token == '<<<' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						n1 = stack.pop();
						n2 = stack.pop();
						num = n2 << n1;
						while(num > 32767) num -= 65536;
						while(num < -32768) num += 65536;
						stack.push(num);

					} else if(token == '>>>' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						n1 = stack.pop();
						n2 = stack.pop();
						num = n2 >> n1;
						while(num > 32767) num -= 65536;
						while(num < -32768) num += 65536;
						stack.push(num);

					} else if(token == '<' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						stack.push(stack.pop() > stack.pop() ? -1 : 0);

					} else if(token == '>' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						stack.push(stack.pop() < stack.pop() ? -1 : 0);

					} else if(token == '<=' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						stack.push(stack.pop() >= stack.pop() ? -1 : 0);

					} else if(token == '>=' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						stack.push(stack.pop() <= stack.pop() ? -1 : 0);

					} else if(token == '==' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						stack.push(stack.pop() == stack.pop() ? -1 : 0);

					} else if(token == '!=' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						stack.push(stack.pop() != stack.pop() ? -1 : 0);

					} else if(token == '&' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						stack.push(stack.pop() & stack.pop());

					} else if(token == '^' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						stack.push(stack.pop() ^ stack.pop());

					} else if(token == '|' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						stack.push(stack.pop() | stack.pop());

					} else if(token == '&&' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						stack.push((stack.pop() & stack.pop() != 0) ? -1 : 0);

					} else if(token == '^^' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						stack.push((stack.pop() ^ stack.pop() != 0) ? -1 : 0);

					} else if(token == '||' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						stack.push((stack.pop() | stack.pop() != 0) ? -1 : 0);

					} else if(token == 'sq' && stack.length >= 1 && typeof stack[stack.length - 1] == 'number') {
						num = stack.pop() ** 2;
						while(num > 32767) num -= 65536;
						while(num < -32768) num += 65536;
						stack.push(num);

					} else if(token == 'abs' && stack.length >= 1 && typeof stack[stack.length - 1] == 'number') {
						num = Math.abs(stack.pop());
						while(num > 32767) num -= 65536;
						while(num < -32768) num += 65536;
						stack.push(num);

					} else if(token == 'min' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						stack.push(Math.min(stack.pop(), stack.pop()));

					} else if(token == 'max' && stack.length >= 2 && typeof stack[stack.length - 1] == 'number' && typeof stack[stack.length - 2] == 'number') {
						stack.push(Math.max(stack.pop(), stack.pop()));

					} else if(token == '(') {
						stack = ['ERROR: missing closing parentheses.'];
						break;
					} else if(token == '[') {
						stack = ['ERROR: missing closing square bracket.'];
						break;
					} else {
						stack = ['ERROR: token "' + token + '" has incorrect number of operands.'];
						break;
					}
				}
				if(stack.length > 1) {
					output.push('ERROR: more than one output (' + stack.toString() + ').')
				} else {
					output.push(stack.toString())
				}
			}
			return output.join('\n');
		}

		update();
	</script>
</html>